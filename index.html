<script>
/* ---------- SOS TAP LOGIC ---------- */
let tapCount = 0;
let tapTimer = null;

document.getElementById("sosBtn").addEventListener("click", () => {
    tapCount++;

    if (tapCount === 1) {
        tapTimer = setTimeout(() => {
            sendSOS("normal"); // single tap
            tapCount = 0;
        }, 1000);
    }

    if (tapCount === 3) {
        clearTimeout(tapTimer);
        sendSOS("strong"); // triple tap
        tapCount = 0;
    }
});

/* ---------- SEND SOS ---------- */
function sendSOS(type) {
    if (!navigator.geolocation) {
        alert("Geolocation not supported");
        return;
    }

    alert("ðŸ“ Fetching locationâ€¦");

    navigator.geolocation.getCurrentPosition(
        (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;

            const link = `https://www.google.com/maps?q=${lat},${lon}`;

            const message =
                type === "strong"
                ? `ðŸš¨ðŸš¨ EMERGENCY ALERT ðŸš¨ðŸš¨\nHELP IMMEDIATELY!\nðŸ“ ${link}`
                : `ðŸš¨ SOS ALERT ðŸš¨\nI need help.\nðŸ“ ${link}`;

            const contacts =
                JSON.parse(localStorage.getItem("guardianContacts")) ||
                ["918078416898"];

            window.location.href =
                `https://wa.me/${contacts[0]}?text=${encodeURIComponent(message)}`;
        },
        () => alert("Please enable GPS")
    );
}

/* ---------- POLICE SIREN ---------- */
let sirenPlaying = false;
function toggleSiren() {
    const siren = document.getElementById("siren");

    if (!sirenPlaying) {
        siren.volume = 1;
        siren.play();
        navigator.vibrate && navigator.vibrate([500, 300, 500, 300]);
        sirenPlaying = true;
    } else {
        siren.pause();
        siren.currentTime = 0;
        navigator.vibrate && navigator.vibrate(0);
        sirenPlaying = false;
    }
}

/* ---------- NAVIGATION ---------- */
function openFakeCall() {
    window.location.href = "fake-call.html";
}

function openSettings() {
    window.location.href = "settings.html";
}

function emergencyCall() {
    window.location.href = "tel:112";
}
</script>
